<!DOCTYPE HTML> 
<html xmlns:th="http://www.thymeleaf.org">
<head>

    <!--css -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css" rel="stylesheet" type="text/css"/>

    <!--js -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.js"></script>

    <!--constants -->
    <script th:inline="javascript">
        similaritydata = /*[[${similaritydata}]]*/ null;
        ppmidata = /*[[${ppmidata}]]*/ null;
        word = /*[[${word}]]*/ null;
    </script>

    <!-- helper functions -->
    <script type="text/javascript"> 
        function decadeFormatter(year) {
            return year + "s"
        }

        function roundingFormatter(value) {
            return d3.format(".2")(value)
        }

        function addWordTo(chart, url, wordBox, error) {
            let word2 = document.getElementById(wordBox).value
            document.getElementById(wordBox).value = ""
            document.getElementById(error).innerHTML = ""
            if (word2 !== "") {
                $.getJSON(url, {
                    word1: word,
                    word2: word2
                }, function (data) {
                    if (data.columns[0].length === 1)
                        document.getElementById(error).innerHTML = word2 + " not covered by corpus";
                    else
                        chart.load(data);
                });
            }
        }

        function chart(bindto, data, y){
            var myy =  y != null ? y : {}
            myy["tick"] = {
                    format: roundingFormatter
                }

            return c3.generate({
                bindto: bindto,
                data: data != null ? data : {"columns": [[]]},
                axis: {
                    x: {
                        tick: {
                            format: decadeFormatter
                        }
                    },
                    y:myy
        }})}
    </script>
    <title>JeDiSem</title>

</head>
<body>


<h2>Similarity Chart</h2>
The following chart shows its similarity to the most similar words over time.
<div id="similaritychart">No matches for
    <td th:text="${word}">not his placeholder</td>
</div>
<script type="text/javascript"> 
    similaritychart = chart("#similaritychart", similaritydata,{
        max: 1,
        min: 0,
        padding: {top: 0, bottom: 0}
    } )
</script>
<form action="javascript:void(0);"
      onsubmit="addWordTo(similaritychart, '/api/similarity', 'addWordToSimilarityTextBox', 'addWordToSimilarityTextBoxError')">
    Add word to graph: <input type="search" id="addWordToSimilarityTextBox"/>
    <input type="submit" value="add"/>
    <span id="addWordToSimilarityTextBoxError"></span>
</form>


<h2>PPMI Chart</h2>
<div id="ppmichart">No matches for <td th:text="${word}">not his placeholder</td></div>
<script type="text/javascript"> 
    ppmichart = chart("#ppmichart", ppmidata)
</script>
<form action="javascript:void(0);"
      onsubmit="addWordTo(ppmichart, '/api/ppmi', 'addWordToPPMITextBox', 'addWordToPPMITextBoxError')">
    Add word to graph: <input type="search" id="addWordToPPMITextBox"/>
    <input type="submit" value="add"/>
    <span id="addWordToPPMITextBoxError"></span>
</form>

</body>
</html>
